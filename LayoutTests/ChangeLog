2022-03-07  Nikolas Zimmermann  <nzimmermann@igalia.com>

        Cleanup RenderLayer::currentTransform()
        https://bugs.webkit.org/show_bug.cgi?id=237553

        Reviewed by NOBODY (OOPS!).

        Mark new WPT test css/css-transforms/animation/transform-box-will-change-transform-layer.html
        as expected to fail.

        * platform/glib/TestExpectations:
        * platform/mac/TestExpectations:
        * platform/win/TestExpectations:

2022-03-07  Jon Lee  <jonlee@apple.com>

        Unreviewed gardening.

        * gpu-process/TestExpectations: Remove tests that were resolved by r290813.

2022-03-07  Oriol Brufau  <obrufau@igalia.com>

        Remove duplicated platform expectations for computed-style.html, computed-style-without-renderer.html, getComputedStyle-basic.xhtml
        https://bugs.webkit.org/show_bug.cgi?id=237534

        Unreviewed test gardening.

        * platform/glib/fast/css/getComputedStyle/computed-style-expected.txt: Removed.
        * platform/glib/fast/css/getComputedStyle/computed-style-without-renderer-expected.txt: Removed.
        * platform/glib/svg/css/getComputedStyle-basic-expected.txt: Removed.
        * platform/ios/fast/css/getComputedStyle/computed-style-expected.txt: Removed.
        * platform/ios/fast/css/getComputedStyle/computed-style-without-renderer-expected.txt: Removed.
        * platform/ios/svg/css/getComputedStyle-basic-expected.txt: Removed.

2022-03-07  Kimmo Kinnunen  <kkinnunen@apple.com>

        LayoutTests/webgl/max-active-contexts-gc.html is flaky
        https://bugs.webkit.org/show_bug.cgi?id=237466

        Reviewed by Alexey Proskuryakov.
        The test:
         - created 16 WebGL contexts
         - unreferenced 8 WebGL contexts.
         - forced gc
         - added 9 WebGL contexts.
        The test tries to test that GC removes unreferenced contexts.
        To assert this, it ends up with 17 contexts, which is 1 above
        the maximum active limit. This means one context is lost and the
        implementation prints one line of error.

        Since the GC is not exact, sometimes it would only collect 7 of the 8
        unreferenced contexts. This would mean two error messages.

        Fix by trying to collect each time a context is unreferenced. This seems to be
        more predictable.

        * webgl/max-active-contexts-gc.html:

2022-03-07  Chris Dumez  <cdumez@apple.com>

        Make "true" count as truthy in window.open()'s boolean features
        https://bugs.webkit.org/show_bug.cgi?id=237530

        Reviewed by Alex Christensen.

        * tests-options.json:

2022-03-07  Chris Dumez  <cdumez@apple.com>

        [Catalina Release wk1] imported/w3c/web-platform-tests/html/browsers/origin/cross-origin-objects/cross-origin-objects.html is a flaky failure
        https://bugs.webkit.org/show_bug.cgi?id=230729
        <rdar://problem/83469625>

        Unreviewed, unskip test as the bots show no recent flakiness.

        * platform/mac-wk1/TestExpectations:

2022-03-07  Antoine Quint  <graouts@webkit.org>

        Parsing of list-style shorthand is incorrect
        https://bugs.webkit.org/show_bug.cgi?id=237515

        Reviewed by Antti Koivisto.

        Some non-WPT tests had the wrong assumption on the shorthand order
        for list-style, so we update those tests to match the spec.

        Additionally, the WPT test css/css-lists/list-style-type-string-004.html now passes.

        * fast/css/cssText-shorthand-expected.txt:
        * fast/css/cssText-shorthand.html:
        * fast/css/getComputedStyle/getComputedStyle-list-style-shorthand-expected.txt:
        * fast/css/getComputedStyle/getComputedStyle-list-style-shorthand.html:
        * platform/mac/TestExpectations:

2022-03-07  Matt Woodrow  <mattwoodrow@apple.com>

        Compute correct containing block override size for items that are subgridden in one dimension only.
        https://bugs.webkit.org/show_bug.cgi?id=236951

        Reviewed by Dean Jackson.

        * TestExpectations:

        Marked existing WPT as passing.

2022-03-05  Alan Bujtas  <zalan@apple.com>

        Remove non-standard display:block UA stylesheet rule for <layer>
        https://bugs.webkit.org/show_bug.cgi?id=236730
        <rdar://problem/89372670>

        Reviewed by Antti Koivisto.

        * inspector/css/shadow-scoped-style-expected.txt:

2022-03-05  Alan Bujtas  <zalan@apple.com>

        [IFC][Integration] Do not bail out on IFC content with floats inside.
        https://bugs.webkit.org/show_bug.cgi?id=237494

        Reviewed by Antti Koivisto.

        * platform/ios/css2.1/t0905-c5525-fltcont-00-d-g-expected.txt:
        * platform/mac/css2.1/t0905-c5525-fltcont-00-d-g-expected.txt:

2022-03-05  Antti Koivisto  <antti@apple.com>

        Resolve ::first-line style eagerly
        https://bugs.webkit.org/show_bug.cgi?id=237362

        Reviewed by Alan Bujtas.

        * TestExpectations:
        * platform/mac/fast/forms/input-baseline-expected.txt:

2022-03-05  Youenn Fablet  <youenn@apple.com>

        Implement remote-inbound-rtp packetsLost
        https://bugs.webkit.org/show_bug.cgi?id=237443

        Reviewed by Eric Carlson.

        * platform/mac/TestExpectations:
        * webrtc/video-stats.html:

2022-03-04  Tyler Wilcock  <tyler_w@apple.com>

        AX: [WebAccessibilityObjectWrapperMac AXAttributeStringSetFont] crashes when given a font with a nil postscript name, font family, or display name
        https://bugs.webkit.org/show_bug.cgi?id=237373

        Reviewed by Chris Fleizach and Andres Gonzalez.

        * accessibility/resources/Litherum.svg: Added.
        * accessibility/svg-font-face-expected.txt: Added.
        * accessibility/svg-font-face.html: Added.
        * platform/glib/TestExpectations: Skip new test.
        * platform/ios/TestExpectations: Enable new test.
        * platform/win/TestExpectations: Skip new test.

        * platform/mac/accessibility/element-line-rects-and-text-expected.txt:
        Before this patch, [WebAccessibilityObjectWrapperBase AXAttributeStringSetStyle] called the iOS
        version of AXAttributeStringSetFont. This patch fixes this. The expectation for this test is updated as a result.

2022-03-04  Kate Cheney  <katherine_cheney@apple.com>

        about:blank iframes do not always inherit parent CSP
        https://bugs.webkit.org/show_bug.cgi?id=236347
        <rdar://problem/88669147>

        Reviewed by Brent Fulgham.

        * http/tests/security/contentSecurityPolicy/block-eval-onload-in-nested-about-blank-iframe-expected.txt: Added.
        * http/tests/security/contentSecurityPolicy/block-eval-onload-in-nested-about-blank-iframe.html: Added
        We can't use modern js-test.js and related functions because
        js-test.js uses eval() and loading it makes the test time out when the
        eval is blocked by the document's CSP. We can't specify unsafe-eval
        because the whole point of this test is to block eval.

2022-03-04  Robert Jenner  <Jenner@apple.com>

        Update WPT css-scroll-snap tests
        https://bugs.webkit.org/show_bug.cgi?id=237358

        Unreviewed test gardening.
        
        * platform/ios-wk2/TestExpectations:

2022-03-04  Chris Dumez  <cdumez@apple.com>

        Home link on weather.gov is not working
        https://bugs.webkit.org/show_bug.cgi?id=237451
        <rdar://60409277>

        Reviewed by Geoff Garen.

        Skip WPT tests that is timing out. I have verified that this WPT test is timing out in Blink as well.

        * TestExpectations:

2022-03-04  Chris Dumez  <cdumez@apple.com>

        Load event never firing after form is submitted
        https://bugs.webkit.org/show_bug.cgi?id=235407
        <rdar://problem/87831049>

        Reviewed by Geoffrey Garen.

        Add layout test coverage (Based on reduction from Sam Sneddon).

        * http/tests/loading/form-submission-no-load-event-expected.txt: Added.
        * http/tests/loading/form-submission-no-load-event.html: Added.

2022-03-04  Said Abou-Hallawa  <said@apple.com>

        [GPU Process] Canvas compositing buffer should be created through its GraphicsContext
        https://bugs.webkit.org/show_bug.cgi?id=237260
        rdar://89196918

        Reviewed by Simon Fraser.

        * gpu-process/TestExpectations:

2022-03-04  Kate Cheney  <katherine_cheney@apple.com>

        CSP report does not get sent to the document in the case of a detached element
        https://bugs.webkit.org/show_bug.cgi?id=237440
        <rdar://problem/89081463>

        Reviewed by Chris Dumez.

        * http/tests/security/contentSecurityPolicy/report-violation-to-document-after-element-has-been-detached-expected.txt: Added.
        * http/tests/security/contentSecurityPolicy/report-violation-to-document-after-element-has-been-detached.html: Added.

2022-03-04  Youenn Fablet  <youenn@apple.com>

        webrtc/canvas-to-peer-connection.html is flakily failing a test assertion
        https://bugs.webkit.org/show_bug.cgi?id=237423

        Reviewed by Eric Carlson.

        WebRTC pipeline is lossy so frames might disappear.
        For that reason, we need to send multiple times the same frame to ensure we can read the expected frame.
        To ensure we are not reading a previous test frame, what we do is changing the size of the canvas before doing the test.
        This patch reduces the number of iterations to ensure the test is not too long to run.

        * webrtc/canvas-to-peer-connection.html:

2022-03-03  Youenn Fablet  <youenn@apple.com>

        fast/mediastream/getUserMedia-to-canvas-1.html and fast/mediastream/getUserMedia-to-canvas-2.html are failing on MacOS when remote video frame flag is enabled
        https://bugs.webkit.org/show_bug.cgi?id=237042
        <rdar://problem/89298601>

        Reviewed by Eric Carlson.

        Video element videoWidth/videoHeight are updated when track settings are changed,
        and not when video frames being received.

        This does not guarantee that videoWidth/videoHeight (main thread) are fully in sync
        with the actual video frames (background thread) when there is a change of size.

        We might be able to tighten this in MediaPlayerPrivateMediaStreamAVFObjC by only resorting on video frames.
        In the meantime, we update the test to use requestVideoFrameCallback which provides accurate per frame metadata.

        * fast/mediastream/getUserMedia-to-canvas-1.html:
        * fast/mediastream/getUserMedia-to-canvas-2.html:
        * webrtc/routines.js:

2022-03-03  Kimmo Kinnunen  <kkinnunen@apple.com>

        WebGL context count is not limited for GPU process
        https://bugs.webkit.org/show_bug.cgi?id=222411

        Reviewed by Kenneth Russell.

        * platform/ios-wk2/TestExpectations:

2022-03-03  Ben Nham  <nham@apple.com>

        Enforce silent push quota
        https://bugs.webkit.org/show_bug.cgi?id=236863

        Reviewed by Brady Eidson.

        Update PushEvent tests to check that notifications are displayed.

        * http/wpt/push-api/pushEvent.any.js:
        (promise_test.async const):
        (promise_test.async if):
        * http/wpt/push-api/pushEvent.any.serviceworker-expected.txt:

2022-03-03  Simon Fraser  <simon.fraser@apple.com>

        Element with position: sticky after sticking, starts to move incorrectly when scrolling
        https://bugs.webkit.org/show_bug.cgi?id=231953
        <rdar://84662329>

        Reviewed by Sam Weinig.

        * platform/ios-wk2/scrollingcoordinator/scrolling-tree/sticky-in-overflow-stale-constraints-expected.txt: Added.
        * scrollingcoordinator/scrolling-tree/sticky-in-overflow-stale-constraints-expected.txt: Added.
        * scrollingcoordinator/scrolling-tree/sticky-in-overflow-stale-constraints.html: Added.

2022-03-03  Simon Fraser  <simon.fraser@apple.com>

        nasa.gov page with fixed backgrounds paints incorrectly on scroll
        https://bugs.webkit.org/show_bug.cgi?id=237405
        <rdar://66568551>

        Reviewed by Antti Koivisto.

        Repaint test which is only valid for mac-wk2 (iOS does not support background-attachment:fixed).

        * TestExpectations:
        * fast/repaint/background-attachment-fixed-in-composited-scroll-expected.txt: Added.
        * fast/repaint/background-attachment-fixed-in-composited-scroll.html: Added.
        * platform/mac-wk2/TestExpectations:

2022-03-03  Jon Lee  <jonlee@apple.com>

        Unreviewed test gardening.

        * gpu-process/TestExpectations:
        * platform/ios/TestExpectations:

2022-03-03  Alan Bujtas  <zalan@apple.com>

        A text node longer than 65,535 characters following another text node is invisible in a scrolling context
        https://bugs.webkit.org/show_bug.cgi?id=237330
        <rdar://problem/89645522>

        Reviewed by Antti Koivisto.

        * fast/text/text-overflow-over-64k-expected.html: Added.
        * fast/text/text-overflow-over-64k.html: Added.

2022-03-03  Youenn Fablet  <youenn@apple.com>

        macOS Safari 15.2 Audio Echo Issue after camera pause/unpause
        https://bugs.webkit.org/show_bug.cgi?id=235544
        <rdar://problem/88297045>

        Reviewed by Eric Carlson.

        * fast/mediastream/mediastreamtrack-audiovideo-mutepage-expected.txt: Added.
        * fast/mediastream/mediastreamtrack-audiovideo-mutepage.html: Added.

2022-03-03  Chris Dumez  <cdumez@apple.com>

        REGRESSION(r290356-r290351?): [ iOS EWS ] 3 imported/w3c/web-platform-tests/service-workers/service-worker/* tests are constant text failures.
        https://bugs.webkit.org/show_bug.cgi?id=237160
        <rdar://problem/89440067>

        Reviewed by Youenn Fablet.

        Unskip tests that are no longer failing.

        * platform/ios/TestExpectations:

2022-03-03  Martin Robinson  <mrobinson@webkit.org>

        Update WPT css-scroll-snap tests
        https://bugs.webkit.org/show_bug.cgi?id=237358

        Reviewed by Manuel Rego Casasnovas.

        * platform/glib/imported/w3c/web-platform-tests/css/css-scroll-snap/scroll-target-margin-005-expected.txt: Added.
        * platform/mac-wk1/imported/w3c/web-platform-tests/css/css-scroll-snap/scroll-target-margin-005-expected.txt: Added.

2022-03-03  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, reverting r290756.
        https://bugs.webkit.org/show_bug.cgi?id=237412

        Speedometer2

        Reverted changeset:

        "[css] Implement 'text-decoration' as a shorthand."
        https://bugs.webkit.org/show_bug.cgi?id=237175
        https://commits.webkit.org/r290756

2022-03-02  Sihui Liu  <sihui_liu@apple.com>

        Throw proper exception on failed removeEntry() calls
        https://bugs.webkit.org/show_bug.cgi?id=237382
        <rdar://89232969>

        Reviewed by Chris Dumez.

        * storage/filesystemaccess/handle-move-expected.txt:
        * storage/filesystemaccess/handle-move-worker-expected.txt:
        * storage/filesystemaccess/resources/handle-move.js:
        (async test):

2022-03-02  Robert Jenner  <Jenner@apple.com>

        WindowServer returned not alive with context:,unresponsive work processor(s)
        <rdar://86037417>

        Unreviewed test gardening. Skipping tests on iOS due to tests causing WindowServer to crash.

        * platform/ios-wk2/TestExpectations:

2022-03-02  Robert Jenner  <Jenner@apple.com>

        Unreviewed, reverting r290658.

        r290658 broke two tests for iOS, slowing down EWS.

        Reverted changeset:

        "fast/mediastream/getUserMedia-to-canvas-1.html and
        fast/mediastream/getUserMedia-to-canvas-2.html are failing on
        MacOS when remote video frame flag is enabled"
        https://bugs.webkit.org/show_bug.cgi?id=237042
        https://commits.webkit.org/r290658

2022-03-02  Simon Fraser  <simon.fraser@apple.com>

        Rendering issues with many dynamically-added sticky elements inside overflow scroll
        https://bugs.webkit.org/show_bug.cgi?id=237378
        <rdar://83745510>

        Reviewed by Cameron McCormack.

        * scrollingcoordinator/scrolling-tree/accumulated-unparented-sticky-nodes-expected.txt: Added.
        * scrollingcoordinator/scrolling-tree/accumulated-unparented-sticky-nodes.html: Added.

2022-03-02  Oriol Brufau  <obrufau@igalia.com>

        [css] Implement 'text-decoration' as a shorthand.
        https://bugs.webkit.org/show_bug.cgi?id=237175

        Reviewed by Darin Adler.

        Update tests to take into account that 'text-decoration' is a shorthand.

        * editing/pasteboard/data-transfer-get-data-on-drop-rich-text-expected.txt:
        * fast/css/getComputedStyle/computed-style-expected.txt:
        * fast/css/getComputedStyle/computed-style-without-renderer-expected.txt:
        * fast/css/getComputedStyle/getComputedStyle-text-decoration-expected.txt:
        * fast/css/getComputedStyle/getComputedStyle-text-decoration.html:
        * fast/css/getComputedStyle/resources/property-names.js:
        * fast/css/style-enumerate-properties-expected.txt:
        * fast/css/style-enumerate-properties.html:
        * fast/css3-text/css3-text-decoration/getComputedStyle/getComputedStyle-text-decoration-shorthand-expected.txt:
        * fast/css3-text/css3-text-decoration/getComputedStyle/getComputedStyle-text-decoration-shorthand.html:
        * fast/css3-text/css3-text-decoration/text-decoration-dashed-expected-mismatch.html:
        * fast/css3-text/css3-text-decoration/text-decoration-dashed.html:
        * fast/css3-text/css3-text-decoration/text-decoration-dotted-dashed-expected-mismatch.html:
        * fast/css3-text/css3-text-decoration/text-decoration-dotted-dashed.html:
        * fast/css3-text/css3-text-decoration/text-decoration-dotted-expected-mismatch.html:
        * fast/css3-text/css3-text-decoration/text-decoration-dotted.html:
        * fast/events/input-events-paste-rich-datatransfer-expected.txt:
        * platform/glib/fast/css/getComputedStyle/computed-style-expected.txt: Removed.
        * platform/glib/fast/css/getComputedStyle/computed-style-without-renderer-expected.txt: Removed.
        * platform/glib/svg/css/getComputedStyle-basic-expected.txt: Removed.
        * platform/gtk/fast/events/input-events-paste-rich-datatransfer-expected.txt:
        * platform/gtk/imported/w3c/web-platform-tests/css/css-cascade/all-prop-initial-xml-expected.txt:
        * platform/gtk/imported/w3c/web-platform-tests/css/cssom/getComputedStyle-detached-subtree-expected.txt:
        * platform/ios/fast/css/getComputedStyle/computed-style-expected.txt: Removed.
        * platform/ios/fast/css/getComputedStyle/computed-style-without-renderer-expected.txt: Removed.
        * platform/ios/imported/w3c/web-platform-tests/css/css-cascade/all-prop-initial-xml-expected.txt:
        * platform/ios/imported/w3c/web-platform-tests/css/cssom/getComputedStyle-detached-subtree-expected.txt:
        * platform/ios/svg/css/getComputedStyle-basic-expected.txt: Removed.
        * platform/wpe/imported/w3c/web-platform-tests/css/css-cascade/all-prop-initial-xml-expected.txt:
        * platform/wpe/imported/w3c/web-platform-tests/css/cssom/getComputedStyle-detached-subtree-expected.txt:
        * svg/css/getComputedStyle-basic-expected.txt:

2022-03-02  J Pascoe  <j_pascoe@apple.com>

        [WebAuthn] Remove obsolete failed attestation tests
        https://bugs.webkit.org/show_bug.cgi?id=237346
        rdar://problem/89647260

        Reviewed by Brent Fulgham.

        The removed items tested that creation fails whenever attestation fails, however
        we've changed behavior such that creation succeeds with 'none' attestation in this
        case, making these failure tests obsolete.

        * http/wpt/webauthn/public-key-credential-create-failure-local-silent.https-expected.txt:
        * http/wpt/webauthn/public-key-credential-create-failure-local-silent.https.html:
        * http/wpt/webauthn/public-key-credential-create-failure-local.https-expected.txt:
        * http/wpt/webauthn/public-key-credential-create-failure-local.https.html:

2022-03-02  Matteo Flores  <matteo_flores@apple.com>

        [ iOS Debug ] editing/async-clipboard/* 20 tests are flaky timeouts on iOS.
        https://bugs.webkit.org/show_bug.cgi?id=237372

        Unreviewed test gardening.

        * platform/ios-wk2/TestExpectations:

2022-03-02  Robert Jenner  <Jenner@apple.com>

        REGRESSION(r290539): [ iOS ] 2X http/wpt/webauthn/public-key-credential-create-failure-local (layout-tests) are constant text failures
        https://bugs.webkit.org/show_bug.cgi?id=237346

        Unreviewed test gardening.

        * platform/ios-wk2/TestExpectations:

2022-03-02  Wenson Hsieh  <wenson_hsieh@apple.com>

        [iOS] Copy context menu action should be titled "Copy Link" when long pressing a non-image link
        https://bugs.webkit.org/show_bug.cgi?id=237367
        rdar://77397886

        Reviewed by Devin Rousso.

        Adjust a couple of layout tests to check for items labeled "Copy" (in the case of an image) and "Copy Link" (in
        the case of a link).

        * fast/events/touch/ios/long-press-on-image-expected.txt:
        * fast/events/touch/ios/long-press-on-image.html:
        * fast/events/touch/ios/long-press-on-link-expected.txt:
        * fast/events/touch/ios/long-press-on-link.html:

2022-03-02  Myles C. Maxfield  <mmaxfield@apple.com>

        [Cocoa] The behavior of navigator-language-ru changed in Monterey / iOS 15
        https://bugs.webkit.org/show_bug.cgi?id=237384
        <rdar://problem/80335706>

        Unreviewed test gardening.

        Add a new test for the new behavior, but keep the old one too for older OSes.

        * fast/text/international/system-language/navigator-language/navigator-language-ru-2-expected.txt: Added.
        * fast/text/international/system-language/navigator-language/navigator-language-ru-2.html: Added.
        * platform/ios-14/TestExpectations:
        * platform/ios/TestExpectations:
        * platform/mac-wk2/TestExpectations:

2022-03-02  Antoine Quint  <graouts@webkit.org>

        Outline-width with transition don't animate correctly
        https://bugs.webkit.org/show_bug.cgi?id=173708

        Reviewed by Antti Koivisto.

        Add a repaint test that checks that the outline is accounted for during the transition.

        * fast/repaint/outline-transition-expected.txt: Added.
        * fast/repaint/outline-transition.html: Added.

2022-03-02  Alan Bujtas  <zalan@apple.com>

        [RTL] Image alt text has incorrect bidi reordering
        https://bugs.webkit.org/show_bug.cgi?id=237366
        <rdar://problem/89687229>

        Reviewed by Antti Koivisto.

        * fast/images/alt-text-with-right-to-left-inline-direction-reordering-expected-mismatch.html: Added.
        * fast/images/alt-text-with-right-to-left-inline-direction-reordering.html: Added.

2022-03-02  Oriol Brufau  <obrufau@igalia.com>

        [css-cascade] Support 'revert-layer' in @keyframes
        https://bugs.webkit.org/show_bug.cgi?id=237152

        Reviewed by Antti Koivisto.

        Expect test to pass.

        * TestExpectations:

2022-03-02  Alan Bujtas  <zalan@apple.com>

        [RTL] Incorrect alt text position in right to left context
        https://bugs.webkit.org/show_bug.cgi?id=237352
        <rdar://problem/89657704>

        Reviewed by Simon Fraser.

        * fast/images/alt-text-with-right-to-left-inline-direction-expected-mismatch.html: Added.
        * fast/images/alt-text-with-right-to-left-inline-direction.html: Added.

2022-03-02  Carlos Garcia Campos  <cgarcia@igalia.com>

        REGRESSION(r216096): [GTK] Test accessibility/gtk/menu-list-unfocused-notifications.html is failing since r216096
        https://bugs.webkit.org/show_bug.cgi?id=171598

        Reviewed by Adrian Perez de Castro.

        Since r216096 the notification for menu list changes is deffered, so we need to wait one run loop cycle to get
        the notifications. Also update the test to ignore notifications that are not interesting like AXLoadComplete and
        AXElementBusyChanged, and update expectations for the new behavior with ATSPI where the notification is emitted
        on the menu and not the combo.

        * accessibility/gtk/menu-list-unfocused-notifications-expected.txt:
        * accessibility/gtk/menu-list-unfocused-notifications.html:
        * platform/gtk/TestExpectations:

2022-03-02  Carlos Garcia Campos  <cgarcia@igalia.com>

        [ATSPI] Test accessibility/select-element-at-index.html is failing
        https://bugs.webkit.org/show_bug.cgi?id=237315

        Reviewed by Adrian Perez de Castro.

        This is because the test contains platform specific behavior for ATK that was migrated to ATSPI by mistake. We
        should behave like all other ports now.

        * accessibility/select-element-at-index.html:
        * platform/glib/TestExpectations:

2022-03-01  Devin Rousso  <drousso@apple.com>

        Web Inspector: add a switch to control whether breakpoint evaluations (condition, ignore count, actions) are also affected by script blackboxing
        https://bugs.webkit.org/show_bug.cgi?id=235274

        Reviewed by Patrick Angle.

        * inspector/debugger/setBlackboxBreakpointEvaluations.html: Added.
        * inspector/debugger/setBlackboxBreakpointEvaluations-expected.txt: Added.

2022-03-01  Matteo Flores  <matteo_flores@apple.com>

        [ iOS ] pointerevents/mouse/* 10 pointer event tests are constant timeouts or failures on iOS.
        https://bugs.webkit.org/show_bug.cgi?id=237348

        Unreviewed test gardening.

        * platform/ios-wk2/TestExpectations:

2022-03-01  Jon Lee  <jonlee@apple.com>

        Unreviewed gardening.

        * gpu-process/TestExpectations: r290542 fixed a number of crashing tests.

2022-03-01  Jon Lee  <jonlee@apple.com>

        Unreviewed gardening.

        * gpu-process/TestExpectations:
        * platform/ios/TestExpectations: r290438 fixed a test failure.

2022-03-01  Jon Lee  <jonlee@apple.com>

        Unreviewed gardening.

        * gpu-process/TestExpectations: r290542 fixed a number of crashing tests.

2022-03-01  Alan Bujtas  <zalan@apple.com>

        REGRESSION(r285232) https://alvaromontoro.github.io/almond.css/demo/ looks wrong in Safari, ok in Chrome and Firefox
        https://bugs.webkit.org/show_bug.cgi?id=237276
        <rdar://problem/89566459>

        Reviewed by Simon Fraser.

        * fast/css-grid-layout/ascpect-ratio-with-percent-width-expected.html: Added.
        * fast/css-grid-layout/ascpect-ratio-with-percent-width.html: Added.

2022-03-01  Said Abou-Hallawa  <said@apple.com>

        [macOS][REGRESSION] (rr289518): Form controls are scaled twice on Retina display
        https://bugs.webkit.org/show_bug.cgi?id=237128
        rdar://89064642

        Reviewed by Darin Adler.

        * fast/hidpi/hidpi-form-controls-drawing-size-expected.html: Added.
        * fast/hidpi/hidpi-form-controls-drawing-size.html: Added.

2022-03-01  Robert Jenner  <Jenner@apple.com>

        [ Win ] 4X imported/mozilla/svg/blend(layout-tests) are constant Image Only Failures
        https://bugs.webkit.org/show_bug.cgi?id=237344

        Unreviewed test gardening. Skipping, for Windows instead of adding an expectation.

        * platform/win/TestExpectations:

2022-03-01  Robert Jenner  <Jenner@apple.com>

        [ Win ] 4X imported/mozilla/svg/blend(layout-tests) are constant Image Only Failures
        https://bugs.webkit.org/show_bug.cgi?id=237344

        Unreviewed test gardening.

        * platform/win/TestExpectations:

2022-03-01  Eric Carlson  <eric.carlson@apple.com>

        [Cocoa] HLS stream currentTime sometimes jumps backwards
        https://bugs.webkit.org/show_bug.cgi?id=235087
        rdar://83831093

        Reviewed by Dean Jackson.

        * http/tests/media/hls/hls-non-zero-start-time-expected.txt: Added.
        * http/tests/media/hls/hls-non-zero-start-time.html: Added.
        * http/tests/media/resources/hls/bip-bop-live.m3u8: Added.
        * http/tests/media/resources/hls/bipbop/start-offset.m3u8: Added.
        * http/tests/media/resources/hls/bipbop/start-offset.ts: Added.

2022-03-01  Matt Woodrow  <mattwoodrow@apple.com>

        Use static position relative to parent for abs-pos items within nested grids.
        https://bugs.webkit.org/show_bug.cgi?id=236957

        Reviewed by Dean Jackson.

        * TestExpectations:

       Existing subgrid tests marked as passing.

2022-03-01  Andres Gonzalez  <andresg_22@apple.com>

        Make accessibility/aria-hidden-false-works-in-subtrees.html async to pass in isolated tree mode.
        https://bugs.webkit.org/show_bug.cgi?id=237051
        <rdar://problem/89312156>

        Reviewed by Chris Fleizach.

        * accessibility/aria-hidden-false-works-in-subtrees.html:
        Made both the main script and the iframe onload function async to pass
        in isolated tree mode.

2022-03-01  Matteo Flores  <matteo_flores@apple.com>

        [ Monterey wk2 ] http/tests/media/video-webm-stall.html is a constant text failure
        https://bugs.webkit.org/show_bug.cgi?id=236788

        Unreviewed test gardening.

        * platform/mac-wk2/TestExpectations:

2022-03-01  Matteo Flores  <matteo_flores@apple.com>

        [ Monterey ] webaudio/decode-audio-data-webm-vorbis.html is constantly failing
        https://bugs.webkit.org/show_bug.cgi?id=236328

        Unreviewed test gardening.

        * platform/mac-wk2/TestExpectations:

2022-03-01  Robert Jenner  <Jenner@apple.com>

        WindowServer returned not alive with context:,unresponsive work processor(s)
        <rdar://86037417>

        Unreviewed test gardening.

        * platform/mac-wk2/TestExpectations:

2022-03-01  Youenn Fablet  <youenn@apple.com>

        fast/mediastream/getUserMedia-to-canvas-1.html and fast/mediastream/getUserMedia-to-canvas-2.html are failing on MacOS when remote video frame flag is enabled
        https://bugs.webkit.org/show_bug.cgi?id=237042
        <rdar://problem/89298601>

        Reviewed by Eric Carlson.

        Video element videoWidth/videoHeight are updated when track settings are changed,
        and not when video frames being received.

        This does not guarantee that videoWidth/videoHeight (main thread) are fully in sync
        with the actual video frames (background thread) when there is a change of size.

        We might be able to tighten this in MediaPlayerPrivateMediaStreamAVFObjC by only resorting on video frames.
        In the meantime, we update the test to set the orientation before creating the source.
        This makes sure the video frames have the expected size and rotation.

        * fast/mediastream/getUserMedia-to-canvas-1.html:
        * fast/mediastream/getUserMedia-to-canvas-2.html:
        * fast/mediastream/resources/getUserMedia-to-canvas.js:

2022-03-01  Chris Dumez  <cdumez@apple.com>

        [Debug] imported/w3c/web-platform-tests/url/toascii.window.html is crashing
        https://bugs.webkit.org/show_bug.cgi?id=236442
        <rdar://problem/89085190>

        Unreviewed, unskip test as it no longer appears to crash in Debug.

        * TestExpectations:

2022-03-01  Wenson Hsieh  <wenson_hsieh@apple.com>

        focus({preventScroll: true}) does not prevent scrolling on iOS
        https://bugs.webkit.org/show_bug.cgi?id=236584
        rdar://88911184

        Reviewed by Simon Fraser.

        Add a couple of new layout tests to verify that passing in `{ preventScroll: true }` for focus options causes
        us to avoid scrolling to reveal focused select elements and text fields.

        * fast/forms/select-focus-prevent-scroll-expected.txt: Added.
        * fast/forms/select-focus-prevent-scroll.html: Added.
        * fast/forms/text-field-focus-prevent-scroll-expected.txt: Added.
        * fast/forms/text-field-focus-prevent-scroll.html: Added.
        * resources/ui-helper.js:

        Also make it safe to call `waitForInputSessionToDismiss()` in a platform-agnostic test, by bailing early if
        we're not on iOS, using WebKit2.

2022-03-01  Alan Bujtas  <zalan@apple.com>

        REGRESSION (r273129): Text contents in <span> with opacity not repainting/updating when sibling element has "will-change: transform"
        https://bugs.webkit.org/show_bug.cgi?id=236876
        <rdar://problem/89180092>

        Reviewed by Simon Fraser.

        * fast/repaint/inline-box-with-self-paint-layer-expected.html: Added.
        * fast/repaint/inline-box-with-self-paint-layer.html: Added.

2022-03-01  Kimmo Kinnunen  <kkinnunen@apple.com>

        WebGL GPUP OpenGL context is not used even if WebGL via Metal is deselected
        https://bugs.webkit.org/show_bug.cgi?id=236505

        Reviewed by Myles C. Maxfield.

        * webgl/resources/test-shader-implementation-language.js: Added.
        (runTest):
        * webgl/webgl-via-metal-flag-off-expected.txt: Added.
        * webgl/webgl-via-metal-flag-off.html: Added.
        * webgl/webgl-via-metal-flag-on-expected.txt: Added.
        * webgl/webgl-via-metal-flag-on.html: Added.

2022-03-01  Cameron McCormack  <heycam@apple.com>

        Make input element UA shadow tree creation lazy
        https://bugs.webkit.org/show_bug.cgi?id=236747

        Reviewed by Aditya Keerthi.

        * fast/forms/lazy-shadow-tree-creation-expected.html: Added.
        * fast/forms/lazy-shadow-tree-creation.html: Added.
        * fast/forms/lazy-shadow-tree-creation.js: Added.
        (supportsType):
        (makeAndAppendInput):
        * LayoutTests/fast/forms/lazy-shadow-tree-creation-crash.html:
        * LayoutTests/fast/forms/lazy-shadow-tree-creation-crash-expected.html:
        Crashtest.
        * fast/shadow-dom/style-resolver-sharing-expected.txt:
        Update to account for the lazy shadow tree being created later.

2022-03-01  Arcady Goldmints-Orlov  <agoldmints@igalia.com>

        [GLIB] Update test expectations and baselines. Unreviewed test gardening.
        https://bugs.webkit.org/show_bug.cgi?id=237310

        * platform/glib/css3/flexbox/line-wrapping-expected.txt:
        * platform/glib/fast/block/positioning/auto/vertical-lr/007-expected.txt:
        * platform/glib/fast/dom/scroll-reveal-top-overflow-expected.txt: Added.
        * platform/glib/tables/mozilla_expected_failures/dom/appendColGroup1-expected.txt:
        * platform/gtk/TestExpectations:
        * platform/gtk/fast/repaint/vertical-text-repaint-expected.txt: Added.
        * platform/gtk/fast/writing-mode/japanese-lr-selection-expected.txt:
        * platform/gtk/tables/mozilla_expected_failures/dom/appendCol1-expected.txt:
        * platform/wpe/fast/repaint/vertical-text-repaint-expected.txt: Added.
        * platform/wpe/fast/writing-mode/japanese-lr-selection-expected.txt:
        * platform/wpe/tables/mozilla_expected_failures/dom/appendCol1-expected.txt:

2022-03-01  Matt Woodrow  <mattwoodrow@apple.com>

        Handle perpendicular containing blocks when computing available logical height.
        https://bugs.webkit.org/show_bug.cgi?id=236953

        Reviewed by Dean Jackson.

        * TestExpectations:

        Existing subgrid tests marked as passing.

2022-03-01  Carlos Garcia Campos  <cgarcia@igalia.com>

        [ATSPI] Remove layout tests checking children added/removed notifications
        https://bugs.webkit.org/show_bug.cgi?id=237272

        Reviewed by Adrian Perez de Castro.

        Children changed notifications are not expected by any other tests because other ports don't support them. We
        already have unit tests to ensure they work as expected so we can just remove the layout tests and ensure we
        don't emit those notifications either.

        * accessibility/children-changed-sends-notification-expected.txt: Removed.
        * accessibility/children-changed-sends-notification.html: Removed.
        * accessibility/gtk/menu-list-unfocused-notifications-expected.txt:
        * accessibility/gtk/no-notification-for-unrendered-iframe-children-expected.txt: Removed.
        * accessibility/gtk/no-notification-for-unrendered-iframe-children.html: Removed.
        * platform/glib/TestExpectations:
        * platform/gtk/TestExpectations:
        * platform/mac/TestExpectations:
        * platform/win/TestExpectations:
        * platform/wincairo-wk1/TestExpectations:

2022-02-28  Tyler Wilcock  <tyler_w@apple.com>

        AX: WebKit should ignore empty modals rather than trapping focus inside them
        https://bugs.webkit.org/show_bug.cgi?id=237163

        Reviewed by Chris Fleizach and Andres Gonzalez.

        * accessibility/ignore-modals-without-any-content-expected.txt: Added.
        * accessibility/ignore-modals-without-any-content.html: Added.
        * platform/glib/TestExpectations: Skip new test.
        * platform/ios/TestExpectations: Enable new test.
        * platform/ios/accessibility/ignore-modals-without-any-content-expected.txt: Added.
        * platform/win/TestExpectations: Skip new test.

2022-02-28  Simon Fraser  <simon.fraser@apple.com>

        Compositing/paint invalidation with transforms
        https://bugs.webkit.org/show_bug.cgi?id=233421
        <rdar://problem/85814854>

        Reviewed by Alan Bujtas.
        
        * compositing/repaint/composite-and-scale-change-expected.txt: Added.
        * compositing/repaint/composite-and-scale-change.html: Added.
            Test that dumps repaint rects.
        * compositing/shared-backing/repaint-into-shared-backing-become-composited-expected.html: Added.
        * compositing/shared-backing/repaint-into-shared-backing-become-composited.html: Added.
            Companion to repaint-into-shared-backing.html but toggles compositing in the other
            direction.
        * platform/gtk/compositing/repaint/composite-and-scale-change-actual.txt: Added.
        * platform/mac-wk1/compositing/repaint/composite-and-scale-change-expected.txt: Added.

2022-02-28  Simon Fraser  <simon.fraser@apple.com>

        No animation when scroll snap scroller is navigated with the keyboard
        https://bugs.webkit.org/show_bug.cgi?id=236244

        Reviewed by Tim Horton.

        Turn off the scroll animator for these tests that assume that scrolling is instantaneous.

        * css3/scroll-snap/scroll-padding-overflow-paging.html:
        * fast/events/wheelevent-in-scrolling-div.html:
        * tiled-drawing/scrolling/scroll-snap/scroll-snap-proximity-overflow-rtl-with-keyboard.html:

2022-02-28  Matteo Flores  <matteo_flores@apple.com>

        [ iOS ] fast/mediastream/video-rotation-gpu-process-crash.html is a flaky crash
        https://bugs.webkit.org/show_bug.cgi?id=237295

        Unreviewed test gardening.

        * platform/ios/TestExpectations:

2022-02-28  Robert Jenner  <Jenner@apple.com>

        REBASELINE [ iOS15 ] fast/text/khmer-lao-font.html is a constant text failure
        <rdar://88841324>

        Unreviewed test gardening. Rebaseline for iOS15.

        * platform/ios-wk2/TestExpectations:
        * platform/ios-wk2/fast/text/khmer-lao-font-expected.txt:
        * platform/ios/fast/text/khmer-lao-font-expected.txt:

2022-02-28  Rob Buis  <rbuis@igalia.com>

        Handle widow relayout differently
        https://bugs.webkit.org/show_bug.cgi?id=235519

        Reviewed by Alan Bujtas.

        * fast/multicol/widow-many-relayouts-crash-expected.txt: Added.
        * fast/multicol/widow-many-relayouts-crash.html: Added.

2022-02-28  Devin Rousso  <drousso@apple.com>

        Web Inspector: add `IterableWeakSet`
        https://bugs.webkit.org/show_bug.cgi?id=237141

        Reviewed by Patrick Angle.

        * inspector/unit-tests/iterableweakset.html: Added.
        * inspector/unit-tests/iterableweakset-expected.txt: Added.

2022-02-28  Matteo Flores  <matteo_flores@apple.com>

        REGRESSION(r288070): [ Monterey ] platform/mac/fast/text/international/Geeza-Pro-vertical-metrics-adjustment.html is a constant text failure.
        https://bugs.webkit.org/show_bug.cgi?id=236857

        Unreviewed test gardening.

        * platform/mac/fast/text/international/Geeza-Pro-vertical-metrics-adjustment-expected.txt: Removed.
        * platform/mac/platform/mac/fast/text/international/Geeza-Pro-vertical-metrics-adjustment-expected.txt: Previous file was in platform/mac/fast... instead of platform/mac/platform/mac/fast...

2022-02-28  Aditya Keerthi  <akeerthi@apple.com>

        [macOS] Unable to upload ".pages" files to file inputs accepting ".pages" and ".jpeg" files
        https://bugs.webkit.org/show_bug.cgi?id=237219
        rdar://89482882

        Reviewed by Tim Horton and Said Abou-Hallawa.

        Add a layout test that contains a file input that accepts ".pages" and
        ".jpeg" files, and attempts to upload a ".pages" file.

        * TestExpectations:
        * fast/forms/file/entries-api/pages-jpeg-open-panel-expected.txt: Added.
        * fast/forms/file/entries-api/pages-jpeg-open-panel.html: Added.
        * fast/forms/file/entries-api/pdf-jpeg-open-panel-expected.txt: Added.
        * fast/forms/file/entries-api/pdf-jpeg-open-panel.html: Added.
        * fast/forms/file/entries-api/resources/documents/document.pages: Added.
        * fast/forms/file/entries-api/resources/documents/document.pdf: Added.
        * platform/mac-wk2/TestExpectations:

2022-02-28  Simon Fraser  <simon.fraser@apple.com>

        Revert r290548
        
        It caused three tests to start failing.

        * css3/scroll-snap/scroll-padding-overflow-paging.html:
        * fast/events/wheelevent-in-scrolling-div.html:
        * tiled-drawing/scrolling/scroll-snap/scroll-snap-proximity-overflow-rtl-with-keyboard.html:

2022-02-28  Pascal Abresch  <nep@packageloss.eu>

        FTP EPLF does not handle directory
        https://bugs.webkit.org/show_bug.cgi?id=45113

        Reviewed by Darin Adler.

        The code used "!result.type" to check for an invalid type. However,
        the first type in the FTPEntryType enum is FTPDirectoryEntry, so this
        was actually returning true for directories, turning them into "junk"
        entries which would not be listed.

        Since the code for EPLF can only result in either files, directories,
        or uninitialized/junk entries, the check can be removed, returning
        result.type is the correct thing to do in all 3 cases.
    
        * http/tests/misc/ftp-eplf-directory-expected.txt: Added.
        * http/tests/misc/ftp-eplf-directory.py: Added.
        * platform/gtk/TestExpectations:

2022-02-28  Carlos Garcia Campos  <cgarcia@igalia.com>

        [ATSPI] Always expose table cells (layout and CSS) that have rendered text content
        https://bugs.webkit.org/show_bug.cgi?id=237204

        Reviewed by Adrian Perez de Castro.

        * accessibility/gtk/nested-block-element-children-expected.txt: Rebaseline.
        * platform/glib/TestExpectations: Remove accessibility/generated-content-with-display-table-crash.html.
        * platform/gtk/TestExpectations: Remove accessibility/gtk/nested-block-element-children.html.

2022-02-28  Carlos Garcia Campos  <cgarcia@igalia.com>

        [GTK][a11y] Test accessibility/gtk/xml-roles-exposed.html is failing since ATSPI switch
        https://bugs.webkit.org/show_bug.cgi?id=237202

        Reviewed by Adrian Perez de Castro.

        * platform/gtk/TestExpectations: Remove accessibility/gtk/xml-roles-exposed.html.
        * platform/gtk/accessibility/gtk/xml-roles-exposed-expected.txt: Rebaseline.

2022-02-27  Jonathan Bedard  <jbedard@apple.com>

        webkitpy: WebSocket server doesn't support Python 3
        https://bugs.webkit.org/show_bug.cgi?id=230319
        <rdar://problem/58814743>

        Reviewed by Fujii Hironori.

        Make all tests Python 3 compatible, even at the cost of Python 2
        compatibility, since WebSocket tests are always invoked with Python 3.

        * TestExpectations:
        * http/tests/websocket/tests/hybi/bad-handshake-crash_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/binary-frames_wsh.py:
        (web_socket_transfer_data):
        (all_distinct_bytes):
        * http/tests/websocket/tests/hybi/broken-utf8_wsh.py:
        (web_socket_transfer_data):
        * http/tests/websocket/tests/hybi/check-binary-messages_wsh.py:
        (web_socket_transfer_data):
        (all_distinct_bytes):
        * http/tests/websocket/tests/hybi/client-close-2-expected.txt:
        * http/tests/websocket/tests/hybi/client-close-2.html:
        * http/tests/websocket/tests/hybi/client-close-2_wsh.py:
        (web_socket_transfer_data):
        * http/tests/websocket/tests/hybi/client-close-expected.txt:
        * http/tests/websocket/tests/hybi/client-close.html:
        * http/tests/websocket/tests/hybi/client-close_wsh.py:
        (web_socket_transfer_data):
        * http/tests/websocket/tests/hybi/close-code-and-reason_wsh.py:
        (web_socket_transfer_data):
        * http/tests/websocket/tests/hybi/close-on-unload_wsh.py:
        (web_socket_transfer_data):
        * http/tests/websocket/tests/hybi/compressed-control-frame_wsh.py:
        (web_socket_transfer_data):
        * http/tests/websocket/tests/hybi/cookie_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/deflate-frame-invalid-parameter_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/deflate-frame_wsh.py:
        (_get_deflate_frame_extension_processor):
        (web_socket_do_extra_handshake):
        (web_socket_transfer_data):
        * http/tests/websocket/tests/hybi/echo-cookie_wsh.py:
        (web_socket_transfer_data):
        * http/tests/websocket/tests/hybi/echo_wsh.py:
        (web_socket_transfer_data):
        * http/tests/websocket/tests/hybi/fragmented-binary-frames_wsh.py:
        (web_socket_transfer_data):
        * http/tests/websocket/tests/hybi/handshake-fail-by-extensions-header_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/handshake-fail-by-invalid-http-version_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/handshake-fail-by-maxlength_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/handshake-fail-by-mismatch-protocol-header_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/handshake-fail-by-more-accept-header_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/handshake-fail-by-more-extensions-header_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/handshake-fail-by-more-protocol-header_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/handshake-fail-by-no-accept-header_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/handshake-fail-by-no-connection-header_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/handshake-fail-by-no-cr_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/handshake-fail-by-no-upgrade-header_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/handshake-fail-by-non-ascii-header-value-sec-websocket-accept_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/handshake-fail-by-non-ascii-header-value-sec-websocket-extensions_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/handshake-fail-by-non-ascii-header-value-sec-websocket-protocol_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/handshake-fail-by-non-ascii-status-line_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/handshake-fail-by-null-char-in-status_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/handshake-fail-by-prepended-null_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/handshake-fail-by-wrong-accept-header_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/handshake-ok-with-http-version-beyond-1_1_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/handshake-ok-with-legacy-sec-websocket-response-headers_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/handshake-ok-with-legacy-websocket-response-headers_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/imported/blink/permessage-deflate-invalid-parameter_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/imported/blink/permessage-deflate-manual_wsh.py:
        * http/tests/websocket/tests/hybi/imported/blink/permessage-deflate-unsolicited-negotiation-response_wsh.py:
        * http/tests/websocket/tests/hybi/imported/blink/permessage-deflate_wsh.py:
        (web_socket_transfer_data):
        * http/tests/websocket/tests/hybi/inspector/binary_wsh.py:
        (web_socket_transfer_data):
        (all_distinct_bytes):
        * http/tests/websocket/tests/hybi/invalid-continuation_wsh.py:
        (web_socket_transfer_data):
        * http/tests/websocket/tests/hybi/invalid-encode-length_wsh.py:
        (web_socket_transfer_data):
        * http/tests/websocket/tests/hybi/pong_wsh.py:
        (web_socket_transfer_data):
        * http/tests/websocket/tests/hybi/protocol-test_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/reserved-bits_wsh.py:
        (_get_deflate_frame_extension_processor):
        (web_socket_transfer_data):
        * http/tests/websocket/tests/hybi/reserved-opcodes_wsh.py:
        (web_socket_transfer_data):
        * http/tests/websocket/tests/hybi/send-file-blob_wsh.py:
        (web_socket_transfer_data):
        (all_distinct_bytes):
        * http/tests/websocket/tests/hybi/too-long-payload_wsh.py:
        (web_socket_transfer_data):
        * http/tests/websocket/tests/hybi/unicode_wsh.py:
        * http/tests/websocket/tests/hybi/unmasked-frames_wsh.py:
        (web_socket_transfer_data):
        * http/tests/websocket/tests/hybi/workers/resources/binary-frames_wsh.py:
        (web_socket_transfer_data):
        (all_distinct_bytes):
        * http/tests/websocket/tests/hybi/workers/resources/check-binary-messages_wsh.py:
        (web_socket_transfer_data):
        (all_distinct_bytes):
        * http/tests/websocket/tests/hybi/workers/resources/no-onmessage-in-sync-op_wsh.py:
        (web_socket_transfer_data):
        * http/tests/websocket/tests/hybi/workers/resources/protocol-test_wsh.py:
        (web_socket_do_extra_handshake):
        * http/tests/websocket/tests/hybi/zero-length-text_wsh.py:
        (web_socket_transfer_data):
        * platform/glib/TestExpectations:
        * platform/ios-wk2/http/tests/websocket/tests/hybi/handshake-fail-by-no-cr-expected.txt:
        * platform/mac-wk2/http/tests/websocket/tests/hybi/client-close-2-expected.txt: Removed.
        * platform/mac-wk2/http/tests/websocket/tests/hybi/client-close-expected.txt: Removed.
        * platform/mac-wk2/http/tests/websocket/tests/hybi/handshake-fail-by-no-cr-expected.txt:
        * platform/mac/TestExpectations:
        * platform/win/TestExpectations:
        * platform/wincairo/TestExpectations:

2022-02-27  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, reverting r290577.
        https://bugs.webkit.org/show_bug.cgi?id=237264

        Breaks ios-wk2 layout test.

        Reverted changeset:

        "Compute correct containing block override size for items that
        are subgridden in one dimension only."
        https://bugs.webkit.org/show_bug.cgi?id=236951
        https://commits.webkit.org/r290577

2022-02-27  Matt Woodrow  <mattwoodrow@apple.com>

        Compute correct containing block override size for items that are subgridden in one dimension only.
        https://bugs.webkit.org/show_bug.cgi?id=236951

        Reviewed by Dean Jackson.

        * TestExpectations:

        Marked existing WPT as passing.

2022-02-27  Matt Woodrow  <mattwoodrow@apple.com>

        Convert grid direction to be relative to subgrid when accounting for extra margin.
        https://bugs.webkit.org/show_bug.cgi?id=236954

        Reviewed by Dean Jackson.

        * TestExpectations:

        Marks existing test orthogonal-writing-mode-003.html as passing.

2022-02-27  Matt Woodrow  <mattwoodrow@apple.com>

        Handle reverse flow direction when converting iterator coords for a subgrid
        https://bugs.webkit.org/show_bug.cgi?id=236955

        Reviewed by Dean Jackson.

        * TestExpectations:

        Marked grid-gap-007.html as now passing, and added bug annotations to
        remaining subgrid failures.

2022-02-27  Philippe Normand  <pnormand@igalia.com>

        [GStreamer] media/video-src-blob-perf.html timing out likely since update to GStreamer 1.20
        https://bugs.webkit.org/show_bug.cgi?id=237256

        Unreviewed, gardening

        * platform/glib/TestExpectations: Flag test as timing out.

2022-02-27  Tim Nguyen  <ntim@apple.com>

        Optimize StyleSharingResolver inert checks
        https://bugs.webkit.org/show_bug.cgi?id=237235

        Reviewed by Youenn Fablet.

        Add small test that style sharing is not wrongly applied.

        * fast/css/inert-style-sharing-expected.html: Added.
        * fast/css/inert-style-sharing.html: Added.

2022-02-27  Tim Nguyen  <ntim@apple.com>

        Re-import inert and <dialog> WPT
        https://bugs.webkit.org/show_bug.cgi?id=237243

        Reviewed by Youenn Fablet.

        Upstream commit: https://github.com/web-platform-tests/wpt/commit/9261ca87db106c1f31f1ab4f54b8f4a2617cbc24

        * TestExpectations:
        * platform/ios-wk2/imported/w3c/web-platform-tests/inert/inert-iframe-hittest.tentative-expected.txt:
        * platform/ios-wk2/imported/w3c/web-platform-tests/inert/inert-iframe-tabbing.tentative-expected.txt:

2022-02-26  Tim Nguyen  <ntim@apple.com>

        Remove Node::deprecatedIsInert
        https://bugs.webkit.org/show_bug.cgi?id=230845

        Reviewed by Antti Koivisto.

        * platform/ios-wk2/imported/w3c/web-platform-tests/html/semantics/interactive-elements/the-dialog-element/dialog-focusing-steps-inert-expected.txt: Added.
        * platform/ios-wk2/imported/w3c/web-platform-tests/html/semantics/interactive-elements/the-dialog-element/dialog-showModal-expected.txt: Added.

2022-02-26  Kate Cheney  <katherine_cheney@apple.com>

        Update CSP handling of javascript URLs
        https://bugs.webkit.org/show_bug.cgi?id=236351
        <rdar://problem/88675827>

        Reviewed by Brent Fulgham.

        * TestExpectations:
        * http/tests/security/contentSecurityPolicy/inline-script-blocked-javascript-url-expected.txt:
        * http/tests/security/contentSecurityPolicy/javascript-url-blocked-by-default-src-star-expected.txt:
        * http/tests/security/contentSecurityPolicy/javascript-url-blocked-expected.txt:

2022-02-26  Alan Bujtas  <zalan@apple.com>

        [RenderTreeBuilder] Clean up descendant floats when a block container becomes float
        https://bugs.webkit.org/show_bug.cgi?id=237238
        <rdar://79960422>

        Reviewed by Antti Koivisto.

        * fast/block/float/float-merge-anon-parent-crash-expected.txt: Added.
        * fast/block/float/float-merge-anon-parent-crash.html: Added.

2022-02-26  Simon Fraser  <simon.fraser@apple.com>

        No animation when scroll snap scroller is navigated with the keyboard
        https://bugs.webkit.org/show_bug.cgi?id=236244

        Reviewed by Tim Horton.

        Turn off the scroll animator for these tests that assume that scrolling is instantaneous.

        * css3/scroll-snap/scroll-padding-overflow-paging.html:
        * fast/events/wheelevent-in-scrolling-div.html:
        * tiled-drawing/scrolling/scroll-snap/scroll-snap-proximity-overflow-rtl-with-keyboard.html:

2022-02-26  Youenn Fablet  <youenn@apple.com>

        REGRESSION(r290358): [ Debug EWS ] ASSERTION FAILED: sample && sample->pixelBuffer()
        https://bugs.webkit.org/show_bug.cgi?id=237164
        <rdar://problem/89442999>

        Unreviewed.

        ASSERTS are fixed through https://bugs.webkit.org/show_bug.cgi?id=237027.
        Removing crash expectations.

        * platform/ios/TestExpectations:
        * platform/mac/TestExpectations:

2022-02-25  Simon Fraser  <simon.fraser@apple.com>

        Scrollbars disappear when very long or wide
        https://bugs.webkit.org/show_bug.cgi?id=237232

        Reviewed by Tim Horton.

        * fast/scrolling/mac/scrollbars/very-wide-overlay-scrollbar-expected-mismatch.html: Added.
        * fast/scrolling/mac/scrollbars/very-wide-overlay-scrollbar.html: Added.

2022-02-25  Chris Dumez  <cdumez@apple.com>

        SharedArrayBuffer posted to AudioWorkletProcessor is not actually shared with the main thread
        https://bugs.webkit.org/show_bug.cgi?id=237144
        <rdar://problem/89479641>

        Reviewed by Darin Adler.

        Add layout test coverage.

        * http/wpt/webaudio/the-audio-api/the-audioworklet-interface/processors/shared-array-buffer-processor.js: Added.
        (SharedArrayBufferTestProcessor):
        (SharedArrayBufferTestProcessor.prototype.process):
        * http/wpt/webaudio/the-audio-api/the-audioworklet-interface/shared-array-buffer.https-expected.txt: Added.
        * http/wpt/webaudio/the-audio-api/the-audioworklet-interface/shared-array-buffer.https.html: Added.
        * http/wpt/webaudio/the-audio-api/the-audioworklet-interface/shared-array-buffer.https.html.headers: Added.

2022-02-25  Robert Jenner  <Jenner@apple.com>

        [ Mac wk1 ] 7X imported/w3c/web-platform-tests/pointerevents/pointerevent (layout-tests) are flaky text failures
        https://bugs.webkit.org/show_bug.cgi?id=236128

        
        Unreviewed test gardening.

        * platform/mac-wk1/TestExpectations:

2022-02-25  Matteo Flores  <matteo_flores@apple.com>

        [ iOS EWS ] imported/w3c/web-platform-tests/svg/coordinate-systems/abspos.html is a flaky image failure.
        https://bugs.webkit.org/show_bug.cgi?id=237220

        Unreviewed test gardening.

        * platform/ios/TestExpectations:

2022-02-25  Matteo Flores  <matteo_flores@apple.com>

        REGRESSION(r289787?) [ iOS EWS ]fast/layers/parent-clipping-overflow-is-overwritten-by-child-clipping.html is a flaky image failure.
        https://bugs.webkit.org/show_bug.cgi?id=237218

        Unreviewed test gardening.

        * platform/ios/TestExpectations:

2022-02-25  Alex Christensen  <achristensen@webkit.org>

        Re-add YouTubePluginReplacement, removed in r285252
        https://bugs.webkit.org/show_bug.cgi?id=237182

        Reviewed by Chris Dumez.

        * TestExpectations:
        * platform/ios-wk2/TestExpectations:
        * platform/win/TestExpectations:
        * security/contentSecurityPolicy/object-src-none-blocks-youtube-plugin-replacement-expected.txt: Copied from LayoutTests/security/contentSecurityPolicy/object-src-none-blocks-youtube-plugin-replacement-expected.txt.
        * security/contentSecurityPolicy/object-src-none-blocks-youtube-plugin-replacement.html: Copied from LayoutTests/security/contentSecurityPolicy/object-src-none-blocks-youtube-plugin-replacement.html.
        * security/contentSecurityPolicy/plugins-types-allows-youtube-plugin-replacement-expected.txt: Copied from LayoutTests/security/contentSecurityPolicy/plugins-types-allows-youtube-plugin-replacement-expected.txt.
        * security/contentSecurityPolicy/plugins-types-allows-youtube-plugin-replacement.html: Copied from LayoutTests/security/contentSecurityPolicy/plugins-types-allows-youtube-plugin-replacement.html.
        * security/contentSecurityPolicy/plugins-types-blocks-youtube-plugin-replacement-expected.txt: Copied from LayoutTests/security/contentSecurityPolicy/plugins-types-blocks-youtube-plugin-replacement-expected.txt.
        * security/contentSecurityPolicy/plugins-types-blocks-youtube-plugin-replacement-without-mime-type-expected.txt: Copied from LayoutTests/security/contentSecurityPolicy/plugins-types-blocks-youtube-plugin-replacement-without-mime-type-expected.txt.
        * security/contentSecurityPolicy/plugins-types-blocks-youtube-plugin-replacement-without-mime-type.html: Copied from LayoutTests/security/contentSecurityPolicy/plugins-types-blocks-youtube-plugin-replacement-without-mime-type.html.
        * security/contentSecurityPolicy/plugins-types-blocks-youtube-plugin-replacement.html: Copied from LayoutTests/security/contentSecurityPolicy/plugins-types-blocks-youtube-plugin-replacement.html.

2022-02-25  J Pascoe  <j_pascoe@apple.com>

        [WebAuthn] Use default pubKeyCredParams if empty in makeCredential
        https://bugs.webkit.org/show_bug.cgi?id=237109
        rdar://problem/89376484

        Reviewed by Brent Fulgham.

        Update tests to take in account using default pubKeyCredParams.

        * http/wpt/webauthn/public-key-credential-create-failure.https-expected.txt:
        * http/wpt/webauthn/public-key-credential-create-failure.https.html:
        * http/wpt/webauthn/public-key-credential-create-success-hid.https-expected.txt:
        * http/wpt/webauthn/public-key-credential-create-success-hid.https.html:

2022-02-25  Alan Bujtas  <zalan@apple.com>

        [Tables] Incorrect table sizing when colgroup comes after tbody
        https://bugs.webkit.org/show_bug.cgi?id=237205
        <rdar://86582214>

        Reviewed by Antti Koivisto.

        * fast/table/table-sizing-fails-when-colgroup-comes-after-content-expected.html: Added.
        * fast/table/table-sizing-fails-when-colgroup-comes-after-content.html: Added.
        * platform/mac/tables/mozilla_expected_failures/dom/appendCol1-expected.txt: Progression.
        * platform/mac/tables/mozilla_expected_failures/dom/appendColGroup1-expected.txt: Progression.

2022-02-25  Youenn Fablet  <youenn@apple.com>

        Non-simple CORS preflight fails due to cache-control header
        https://bugs.webkit.org/show_bug.cgi?id=236837
        <rdar://problem/89382796>

        Reviewed by Chris Dumez.

        * http/wpt/service-workers/cache-control-request-expected.txt:
        * http/wpt/service-workers/cache-control-request.html:
        * http/wpt/service-workers/resources/cross-origin-allow-for-beacon.py: Added.

2022-02-25  Kimmo Kinnunen  <kkinnunen@apple.com>

        REGRESSION(r289580): [ iOS macOS ] TestWebKitAPI.IPCTestingAPI.CanReceiveSharedMemory is a constant timeout
        https://bugs.webkit.org/show_bug.cgi?id=236744

        Reviewed by Antti Koivisto.

        * ipc/stream-sync-reply-shared-memory-expected.txt: Added.
        * ipc/stream-sync-reply-shared-memory.html: Added.

2022-02-25  Carlos Garcia Campos  <cgarcia@igalia.com>

        AX: List item marker not exposed when not a direct child of a list item
        https://bugs.webkit.org/show_bug.cgi?id=236777
        <rdar://problem/89082485>

        Reviewed by Adrian Perez de Castro.

        Update test results.

        * accessibility/gtk/list-items-always-exposed-expected.txt:
        * accessibility/gtk/list-items-always-exposed.html:
        * accessibility/gtk/spans-expected.txt:
        * accessibility/gtk/spans.html:
        * platform/gtk/TestExpectations:

2022-02-25  Arcady Goldmints-Orlov  <agoldmints@igalia.com>

        [GLIB] Update test baselines after various LFC improvements.
        https://bugs.webkit.org/show_bug.cgi?id=237184

        Unreviewed test gardening.

        * platform/glib/fast/backgrounds/background-leakage-transforms-expected.txt:
        * platform/glib/fast/backgrounds/border-radius-split-background-expected.txt:
        * platform/glib/fast/backgrounds/border-radius-split-background-image-expected.txt:
        * platform/glib/fast/block/positioning/auto/vertical-lr/001-expected.txt:
        * platform/glib/fast/block/positioning/auto/vertical-lr/002-expected.txt:
        * platform/glib/fast/block/positioning/auto/vertical-lr/003-expected.txt:
        * platform/glib/fast/block/positioning/auto/vertical-lr/004-expected.txt:
        * platform/glib/fast/block/positioning/auto/vertical-lr/006-expected.txt:
        * platform/glib/fast/block/positioning/vertical-lr/002-expected.txt:
        * platform/glib/fast/borders/border-image-outset-split-inline-vertical-lr-expected.txt:
        * platform/glib/fast/replaced/vertical-lr/absolute-position-percentage-width-expected.txt:
        * platform/glib/fast/replaced/vertical-lr/absolute-position-with-auto-height-and-top-and-bottom-expected.txt:
        * platform/glib/fast/replaced/vertical-lr/absolute-position-with-auto-width-and-left-and-right-expected.txt:
        * platform/glib/fast/table/border-collapsing/002-vertical-expected.txt:
        * platform/glib/fast/writing-mode/basic-vertical-line-expected.txt:
        * platform/glib/fast/writing-mode/border-image-vertical-lr-expected.txt:
        * platform/glib/fast/writing-mode/border-radius-clipping-vertical-lr-expected.txt:
        * platform/glib/fast/writing-mode/border-styles-vertical-lr-expected.txt:
        * platform/glib/fast/writing-mode/border-styles-vertical-lr-mixed-expected.txt:
        * platform/glib/fast/writing-mode/border-styles-vertical-rl-expected.txt:
        * platform/glib/fast/writing-mode/border-styles-vertical-rl-mixed-expected.txt:
        * platform/glib/fast/writing-mode/border-vertical-lr-expected.txt:
        * platform/glib/fast/writing-mode/box-shadow-vertical-lr-expected.txt:
        * platform/glib/fast/writing-mode/japanese-lr-text-expected.txt:
        * platform/glib/imported/w3c/web-platform-tests/css/cssom-view/offsetTopLeft-empty-inline-expected.txt: Added.
        * platform/glib/imported/w3c/web-platform-tests/css/cssom-view/offsetTopLeft-leading-space-inline-expected.txt: Added.
        * platform/gtk/fast/block/lineboxcontain/inline-box-vertical-expected.txt:
        * platform/gtk/fast/html/details-writing-mode-expected.txt:
        * platform/gtk/fast/html/details-writing-mode-mixed-expected.txt:
        * platform/gtk/fast/lists/003-vertical-expected.txt:
        * platform/gtk/fast/overflow/overflow-rtl-vertical-expected.txt:
        * platform/gtk/fast/text/international/synthesized-italic-vertical-latin-expected.txt:
        * platform/gtk/fast/writing-mode/english-lr-text-expected.txt:
        * platform/gtk/fast/writing-mode/text-orientation-basic-expected.txt:
        * platform/gtk/fast/writing-mode/vertical-lr-replaced-selection-expected.txt:
        * platform/gtk/imported/w3c/web-platform-tests/css/cssom-view/offsetTopLeft-empty-inline-expected.txt: Removed.
        * platform/gtk/imported/w3c/web-platform-tests/css/cssom-view/offsetTopLeft-leading-space-inline-expected.txt: Removed.
        * platform/wpe/fast/block/lineboxcontain/inline-box-vertical-expected.txt:
        * platform/wpe/fast/html/details-writing-mode-expected.txt:
        * platform/wpe/fast/html/details-writing-mode-mixed-expected.txt:
        * platform/wpe/fast/lists/003-vertical-expected.txt:
        * platform/wpe/fast/overflow/overflow-rtl-vertical-expected.txt:
        * platform/wpe/fast/text/international/synthesized-italic-vertical-latin-expected.txt:
        * platform/wpe/fast/writing-mode/english-lr-text-expected.txt:
        * platform/wpe/fast/writing-mode/text-orientation-basic-expected.txt:
        * platform/wpe/fast/writing-mode/vertical-lr-replaced-selection-expected.txt:
        * platform/wpe/imported/w3c/web-platform-tests/css/cssom-view/offsetTopLeft-empty-inline-expected.txt: Removed.
        * platform/wpe/imported/w3c/web-platform-tests/css/cssom-view/offsetTopLeft-leading-space-inline-expected.txt: Removed.

2022-02-24  Alan Bujtas  <zalan@apple.com>

        Unreviewed test gardening after r290454.

        * TestExpectations: Progressions.

2022-02-24  Matteo Flores  <matteo_flores@apple.com>

        [ iOS ] editing/pasteboard/dom-paste/dom-paste-same-origin.html is a flaky timeout/failure
        https://bugs.webkit.org/show_bug.cgi?id=237174

        Unreviewed test gardening.

        * platform/ios/TestExpectations:

2022-02-24  Matteo Flores  <matteo_flores@apple.com>

        [ BigSur+ EWS ] imported/w3c/web-platform-tests/speech-api/SpeechSynthesis-speak-twice.html is a flaky ASSERTION FAILED / failure
        https://bugs.webkit.org/show_bug.cgi?id=237172

        Unreviewed test gardening.

        * platform/mac/TestExpectations:

2022-02-24  Matteo Flores  <matteo_flores@apple.com>

        REGRESSION(r290358): [ Debug EWS ] ASSERTION FAILED: sample && sample->pixelBuffer()
        https://bugs.webkit.org/show_bug.cgi?id=237164

        Unreviewed test gardening.

        * platform/ios/TestExpectations:
        * platform/mac/TestExpectations:

2022-02-24  Robert Jenner  <Jenner@apple.com>

        [ BigSur+ EWS ] webgl/pending/conformance/textures/misc/tex-image-video-repeated.html is a flaky timeout
        https://bugs.webkit.org/show_bug.cgi?id=237166

        Unreviewed test gardening.

        * platform/mac/TestExpectations:

2022-02-24  Robert Jenner  <Jenner@apple.com>

        [ BigSur+ Debug wk2 EWS ] imported/w3c/web-platform-tests/html/webappapis/dynamic-markup-insertion/opening-the-input-stream/quirks.window.html is a flaky crash
        https://bugs.webkit.org/show_bug.cgi?id=237165

        Unreviewed test gardening.

        * platform/mac-wk2/TestExpectations:

2022-02-24  Matteo Flores  <matteo_flores@apple.com>

        REGRESSION(r290356-r290351?): [ iOS15 ] 3 imported/w3c/web-platform-tests/service-workers/service-worker/* tests are constant text failures.
        https://bugs.webkit.org/show_bug.cgi?id=237160

        Unreviewed test gardening.

        * platform/ios/TestExpectations:

2022-02-24  Robert Jenner  <Jenner@apple.com>

        REGRESSION(r290351-r290356?): [ iOS EWS ] imported/w3c/web-platform-tests/service-workers/service-worker/partitioned-service-worker-getRegistrations.tentative.https.html is a constant text failure
        https://bugs.webkit.org/show_bug.cgi?id=237162

        Unreviewed test gardening.

        * platform/ios/TestExpectations:

2022-02-24  Robert Jenner  <Jenner@apple.com>

        REGRESSION(r290356-r290351?):[ iOS EWS ] imported/w3c/web-platform-tests/service-workers/service-worker/fetch-request-no-freshness-headers.https.html  is a constant text failure
        https://bugs.webkit.org/show_bug.cgi?id=237161

        Unreviewed test gardening.

        * platform/ios/TestExpectations:

2022-02-24  Robert Jenner  <Jenner@apple.com>

        [ iOS EWS ]imported/w3c/web-platform-tests/css/css-contain/content-visibility/content-visibility-049.htmlis a flaky crash
        https://bugs.webkit.org/show_bug.cgi?id=237159

        Unreviewed test gardening.

        * platform/ios/TestExpectations:

2022-02-24  Robert Jenner  <Jenner@apple.com>

        REGRESSION (r289765-r289784): [iOS] Flaky crash under WebKit::RemoteLayerTreeDrawingAreaProxy::commitLayerTree()
        https://bugs.webkit.org/show_bug.cgi?id=236794

        Unreviewed test gardening.

        * platform/ios/TestExpectations:

2022-02-24  Matteo Flores  <matteo_flores@apple.com>

        [ iOS15 ] fast/events/autoscroll-in-iframe-body.html is a flaky failure.
        https://bugs.webkit.org/show_bug.cgi?id=237150

        Unreviewed Test Gardening.

        * platform/ios/TestExpectations: Flaky Failure expectation while investigating

2022-02-24  Megan Gardner  <megan_gardner@apple.com>

        Add percent decoding to Scroll to Text Fragment parsing.
        https://bugs.webkit.org/show_bug.cgi?id=236818

        Reviewed by Chris Dumez.

        * http/wpt/html/dom/scroll-to-text-fragment/scroll-to-text-fragment-start-emoji-expected.html: Added.
        * http/wpt/html/dom/scroll-to-text-fragment/scroll-to-text-fragment-start-emoji.html: Added.
        * http/wpt/html/dom/scroll-to-text-fragment/scroll-to-text-fragment-start-expected.html: Added.
        * http/wpt/html/dom/scroll-to-text-fragment/scroll-to-text-fragment-start-sentence-expected.html: Added.
        * http/wpt/html/dom/scroll-to-text-fragment/scroll-to-text-fragment-start-sentence.html: Added.
        * http/wpt/html/dom/scroll-to-text-fragment/scroll-to-text-fragment-start.html: Added.

2022-02-24  Alan Bujtas  <zalan@apple.com>

        [IFC][Integration] Enable non-paginated vertical-rl writing mode
        https://bugs.webkit.org/show_bug.cgi?id=236897

        Reviewed by Antti Koivisto.

        * fast/repaint/vertical-text-repaint-expected.txt:
        * platform/ios-simulator-wk2/imported/w3c/web-platform-tests/css/cssom-view/offsetTopLeft-empty-inline-expected.txt:
        * platform/ios-simulator-wk2/imported/w3c/web-platform-tests/css/cssom-view/offsetTopLeft-leading-space-inline-expected.txt:
        * platform/ios/fast/backgrounds/border-radius-split-background-expected.txt:
        * platform/ios/fast/backgrounds/border-radius-split-background-image-expected.txt:
        * platform/ios/fast/borders/border-image-outset-split-inline-vertical-lr-expected.txt:
        * platform/ios/fast/writing-mode/border-styles-vertical-rl-expected.txt:
        * platform/ios/fast/writing-mode/border-styles-vertical-rl-mixed-expected.txt:
        * platform/mac/fast/backgrounds/border-radius-split-background-expected.txt:
        * platform/mac/fast/backgrounds/border-radius-split-background-image-expected.txt:
        * platform/mac/fast/borders/border-image-outset-split-inline-vertical-lr-expected.txt:
        * platform/mac/fast/table/border-collapsing/004-vertical-expected.txt:
        * platform/mac/fast/writing-mode/border-styles-vertical-rl-expected.txt:
        * platform/mac/fast/writing-mode/border-styles-vertical-rl-mixed-expected.txt:

2022-02-24  Kate Cheney  <katherine_cheney@apple.com>

        Update CSP console logging
        https://bugs.webkit.org/show_bug.cgi?id=232216
        <rdar://problem/89322580>

        Reviewed by Brent Fulgham.

        * http/tests/security/contentSecurityPolicy/audio-redirect-blocked-expected.txt:
        * http/tests/security/contentSecurityPolicy/audio-redirect-blocked.html:
        * http/tests/security/contentSecurityPolicy/font-redirect-blocked-expected.txt:
        * http/tests/security/contentSecurityPolicy/font-redirect-blocked.html:
        * http/tests/security/contentSecurityPolicy/image-redirect-blocked-expected.txt:
        * http/tests/security/contentSecurityPolicy/image-redirect-blocked.html:
        * http/tests/security/contentSecurityPolicy/report-blocked-uri-after-multiple-redirects-expected.txt:
        * http/tests/security/contentSecurityPolicy/script-redirect-blocked-expected.txt:
        * http/tests/security/contentSecurityPolicy/script-redirect-blocked.html:
        * http/tests/security/contentSecurityPolicy/stylesheet-redirect-blocked-expected.txt:
        * http/tests/security/contentSecurityPolicy/stylesheet-redirect-blocked.html:
        * http/tests/security/contentSecurityPolicy/svg-font-redirect-blocked-expected.txt:
        * http/tests/security/contentSecurityPolicy/svg-font-redirect-blocked.html:
        * http/tests/security/contentSecurityPolicy/svg-image-redirect-blocked-expected.txt:
        * http/tests/security/contentSecurityPolicy/svg-image-redirect-blocked.html:
        * http/tests/security/contentSecurityPolicy/track-redirect-blocked-expected.txt:
        * http/tests/security/contentSecurityPolicy/track-redirect-blocked.html:
        * http/tests/security/contentSecurityPolicy/video-redirect-blocked-expected.txt:
        * http/tests/security/contentSecurityPolicy/video-redirect-blocked.html:
        * http/tests/security/contentSecurityPolicy/xsl-redirect-blocked-expected.txt:

2022-02-24  Alan Bujtas  <zalan@apple.com>

        [LFC][IFC] Non-orthogonal inline block boxes keep their baseline on ideographic lines
        https://bugs.webkit.org/show_bug.cgi?id=236946

        Reviewed by Antti Koivisto.

        * platform/mac/fast/writing-mode/border-styles-vertical-lr-mixed-expected.txt: Progression

2022-02-24  Devin Rousso  <drousso@apple.com>

        Web Inspector: merge WI.OverlayManager into WI.DOMNode
        https://bugs.webkit.org/show_bug.cgi?id=236533

        Reviewed by Patrick Angle.

        * inspector/dom/showFlexOverlay.html:
        * inspector/dom/showGridOverlay.html:
        Replace direct `DOMAgent` calls with equivalent `WI.DOMNode` methods.

2022-02-24  Frédéric Wang  <fwang@igalia.com>

        RELEASE_ASSERT(!renderer()); in WebCore::Node::~Node() + 479 (Node.cpp:366)
        https://bugs.webkit.org/show_bug.cgi?id=235380

        Reviewed by Ryosuke Niwa.

        Add non-regression test.

        * fast/shadow-dom/slot-with-pseudo-element-children-renderer-teardown-expected.txt: Added.
        * fast/shadow-dom/slot-with-pseudo-element-children-renderer-teardown.html: Added.

2022-02-24  Youenn Fablet  <youenn@apple.com>

        webrtc/video-replace-muted-track.html is unnecessary long to run
        https://bugs.webkit.org/show_bug.cgi?id=237086

        Reviewed by Peng Liu.

        * platform/mac/TestExpectations: Unflake test since it is no longer flaky in bots.
        * webrtc/routines.js:
        We were waiting for 360 iterations to validate no black frame is found in webrtc/routines.js.
        This makes it last around 20 seconds.
        Decrease the number of iterations to 40, around 2 seconds by decrementing counter from provided value
        instead of incrementing value up to 400.

2022-02-24  Alejandro G. Castro  <alex@igalia.com>

        Unreviewed test gardening.

        Another WebGL test with failing expected results in glib.

        * platform/glib/TestExpectations:
        * platform/glib/webgl/webgl-allow-shared-expected.txt: Removed.

2022-02-23  Commit Queue  <commit-queue@webkit.org>

        Unreviewed, reverting r290284.
        https://bugs.webkit.org/show_bug.cgi?id=237131

        It is preventing the fuzzer from finding other bugs

        Reverted changeset:

        "Make input element UA shadow tree creation lazy"
        https://bugs.webkit.org/show_bug.cgi?id=236747
        https://commits.webkit.org/r290284

2022-02-23  Tim Nguyen  <ntim@apple.com>

        Use of showModalDialog should appear as a warning in WI console
        https://bugs.webkit.org/show_bug.cgi?id=237046

        Reviewed by Devin Rousso.

        Test gardening to take in account new console warning.

        * fast/animation/request-animation-frame-during-modal-expected.txt:
        * fast/dom/Window/open-window-min-size-expected.txt:
        * fast/events/show-modal-dialog-onblur-onfocus-expected.txt:
        * http/tests/cookies/document-cookie-after-showModalDialog-expected.txt:
        * http/tests/security/navigate-when-restoring-cached-page-expected.txt:
        * http/tests/security/showModalDialog-sync-cross-origin-page-load2-expected.txt:
        * platform/mac-wk1/fast/events/beforeunload-showModalDialog-expected.txt: Added.
        * platform/mac-wk1/fast/events/pagehide-showModalDialog-expected.txt: Added.
        * platform/mac-wk1/fast/events/unload-showModalDialog-expected.txt: Added.
        * platform/wincairo-wk1/fast/events/beforeunload-showModalDialog-expected.txt: Added.
        * platform/wincairo-wk1/fast/events/pagehide-showModalDialog-expected.txt: Added.
        * platform/wincairo-wk1/fast/events/unload-showModalDialog-expected.txt: Added.

2022-02-23  Robert Jenner  <Jenner@apple.com>

        [ Mac wk1 Release ] imported/w3c/web-platform-tests/html/user-activation/activation-trigger-pointerevent.html is a constant text failure
        https://bugs.webkit.org/show_bug.cgi?id=236126

        Unreviewed test gardening.

        * platform/mac-wk1/TestExpectations:

2022-02-23  Robert Jenner  <Jenner@apple.com>

        Unreviewed, reverting r290351 and r290404.

        Broke the build after revert of initial commit (r290348)
        Rebases no longer needed due to revert

        Reverted changesets:

        "Use of showModalDialog should appear as a warning in WI
        console"
        https://bugs.webkit.org/show_bug.cgi?id=237046
        https://commits.webkit.org/r290351

        "Use of showModalDialog should appear as a warning in WI
        console"
        https://bugs.webkit.org/show_bug.cgi?id=237046
        https://commits.webkit.org/r290404

2022-02-23  Robert Jenner  <Jenner@apple.com>

        Use of showModalDialog should appear as a warning in WI console
        https://bugs.webkit.org/show_bug.cgi?id=237046

        Unreviewed test gardening. Rebase for wk1 mac and Windows tests.

        * platform/mac-wk1/fast/events/beforeunload-showModalDialog-expected.txt: Added.
        * platform/mac-wk1/fast/events/pagehide-showModalDialog-expected.txt: Added.
        * platform/mac-wk1/fast/events/unload-showModalDialog-expected.txt: Added.
        * platform/wincairo-wk1/fast/events/beforeunload-showModalDialog-expected.txt: Added.
        * platform/wincairo-wk1/fast/events/pagehide-showModalDialog-expected.txt: Added.
        * platform/wincairo-wk1/fast/events/unload-showModalDialog-expected.txt: Added.

2022-02-23  J Pascoe  <j_pascoe@apple.com>

        [WebAuthn] Improve error message for missing pubKeyCredParams
        https://bugs.webkit.org/show_bug.cgi?id=235421
        rdar://87884875

        Reviewed by Brent Fulgham.

        Update test to reflect new error message.

        * http/wpt/webauthn/public-key-credential-create-failure.https.html:

2022-02-23  Alan Bujtas  <zalan@apple.com>

        [Subpixel] imported/w3c/web-platform-tests/css/css-flexbox/auto-margins-001.html fails at certain font sizes
        https://bugs.webkit.org/show_bug.cgi?id=217643
        <rdar://problem/70464703>

        Unreviewed gardening.

        * platform/ios-simulator-wk2/TestExpectations: It must have progressed at some point.

2022-02-23  Robert Jenner  <Jenner@apple.com>

        [ Mac EWS ] imported/w3c/web-platform-tests/workers/semantics/multiple-workers/004.html is a flaky text failure
        https://bugs.webkit.org/show_bug.cgi?id=237095

        Unreviewed test gardening.

        * platform/mac-wk2/TestExpectations: Setting [ Pass Failure ] expectations for flaky test failure that is slowing down EWS.

2022-02-23  Jon Lee  <jonlee@apple.com>

        Unreviewed gardening for GPU Process bot.

        * imported/blink/svg/paintorder/paintorder.svg:

2022-02-23  Jon Lee  <jonlee@apple.com>

        Test gardening for [CSS Blending] Non-separable blend modes don't work
        https://bugs.webkit.org/show_bug.cgi?id=131354

        Unreviewed.
        * TestExpectations:

2022-02-23  Andres Gonzalez  <andresg_22@apple.com>

        Fix for assert crash in AccessibilityRenderObject::visiblePositionForIndex.
        https://bugs.webkit.org/show_bug.cgi?id=236795
        rdar://89025180

        Reviewed by Chris Fleizach.

        * accessibility/native-text-control-attributed-string-expected.txt: Added.
        * accessibility/native-text-control-attributed-string.html: Added.

2022-02-23  Alejandro G. Castro  <alex@igalia.com>

        Unreviewed test gardening.

        These tests had incorrect expected results with failing tests for
        glib.

        * platform/glib/TestExpectations:
        * platform/glib/webgl/1.0.3/conformance/context/context-lost-restored-expected.txt: Removed.
        * platform/glib/webgl/1.0.3/conformance/extensions/oes-texture-half-float-expected.txt: Removed.
        * platform/glib/webgl/1.0.3/conformance/extensions/webgl-compressed-texture-s3tc-expected.txt: Removed.
        * platform/glib/webgl/1.0.3/conformance/extensions/webgl-compressed-texture-size-limit-expected.txt: Removed.
        * platform/glib/webgl/1.0.3/conformance/misc/webgl-specific-expected.txt: Removed.
        * platform/glib/webgl/1.0.3/conformance/renderbuffers/framebuffer-object-attachment-expected.txt: Removed.
        * platform/glib/webgl/1.0.3/conformance/rendering/point-no-attributes-expected.txt: Removed.
        * platform/glib/webgl/1.0.3/conformance/textures/texture-copying-feedback-loops-expected.txt: Removed.

2022-02-23  Kimmo Kinnunen  <kkinnunen@apple.com>

        Crash when calling WEBGL_lose_context.loseContext() after the context has been lost
        https://bugs.webkit.org/show_bug.cgi?id=236966

        Reviewed by Dean Jackson.

        * webgl/lose-context-after-context-lost-expected.txt: Added.
        * webgl/lose-context-after-context-lost.html: Added.

2022-02-23  Youenn Fablet  <youenn@apple.com>

        Enable WebRTCRemoteVideoFrameEnabled by default in WebKitTestRunner
        https://bugs.webkit.org/show_bug.cgi?id=236969

        Reviewed by Eric Carlson.

        Disable WebRTCRemoteVideoFrameEnabled for those two tests until we figure out why they fail more with this option.

        * fast/mediastream/getUserMedia-to-canvas-1.html:
        * fast/mediastream/getUserMedia-to-canvas-2.html:

2022-02-22  Chris Dumez  <cdumez@apple.com>

        http/wpt/push-api/onpush-disabled.html fails
        https://bugs.webkit.org/show_bug.cgi?id=236874
        <rdar://problem/89176154>

        Reviewed by Youenn Fablet.

        Unskip test that should no longer be flaky.

        * TestExpectations:

2022-02-22  Tim Nguyen  <ntim@apple.com>

        Use of showModalDialog should appear as a warning in WI console
        https://bugs.webkit.org/show_bug.cgi?id=237046

        Reviewed by Devin Rousso and Darin Adler.

        Test gardening to take in account new console warning.

        * fast/animation/request-animation-frame-during-modal-expected.txt:
        * fast/dom/Window/open-window-min-size-expected.txt:
        * fast/events/show-modal-dialog-onblur-onfocus-expected.txt:
        * http/tests/cookies/document-cookie-after-showModalDialog-expected.txt:
        * http/tests/security/navigate-when-restoring-cached-page-expected.txt:
        * http/tests/security/showModalDialog-sync-cross-origin-page-load2-expected.txt:

2022-02-22  Ryan Haddad  <ryanhaddad@apple.com>

        Unreviewed test gardening for rdar://86037417.

        * platform/mac-wk2/TestExpectations:

2022-02-22  Frédéric Wang  <fwang@igalia.com>

        null ptr deref via WebXRSystem::requestSession
        https://bugs.webkit.org/show_bug.cgi?id=235916

        Reviewed by Dean Jackson.

        Add non-regression test.

        * webxr/xr-requestSession-crash-expected.txt: Added.
        * webxr/xr-requestSession-crash.html: Added.

2022-02-22  Philippe Normand  <pnormand@igalia.com>

        [GStreamer] Initial MediaRecorder implementation
        https://bugs.webkit.org/show_bug.cgi?id=236558

        Reviewed by Xabier Rodriguez-Calvar.

        Flag the remaining MediaRecorder test failures. Those will be adressed in follow-up patches.

        * http/wpt/mediarecorder/pause-recording.html:
        * platform/glib/TestExpectations:

2022-02-22  Kate Cheney  <katherine_cheney@apple.com>

        Authenticated encryption console logging causing performance regressions
        https://bugs.webkit.org/show_bug.cgi?id=236987
        <rdar://problem/89108253>

        Reviewed by Chris Dumez.

        * crypto/subtle/aes-cbc-cfb-decrypt-malformed-parameters-expected.txt:
        * crypto/subtle/aes-cbc-cfb-encrypt-malformed-parameters-expected.txt:
        * crypto/subtle/aes-cbc-generate-key-encrypt-decrypt-expected.txt:
        * crypto/subtle/aes-cbc-import-key-decrypt-expected.txt:
        * crypto/subtle/aes-cbc-import-key-encrypt-expected.txt:
        * crypto/subtle/aes-ctr-encrypt-malformed-parameters-expected.txt:
        * crypto/subtle/aes-ctr-generate-key-encrypt-decrypt-expected.txt:
        * crypto/subtle/aes-ctr-import-key-encrypt-expected.txt:
        * platform/glib/crypto/subtle/aes-cbc-cfb-decrypt-malformed-parameters-expected.txt:
        * platform/glib/crypto/subtle/aes-cbc-cfb-encrypt-malformed-parameters-expected.txt:

2022-02-22  Youenn Fablet  <youenn@apple.com>

        http/wpt/mediarecorder/mute-tracks.html fails with WebRTCRemoteVideoFrameEnabled=true
        https://bugs.webkit.org/show_bug.cgi?id=237021

        Reviewed by Kimmo Kinnunen.

        * http/wpt/mediarecorder/mute-tracks.html:

2022-02-22  Tim Nguyen  <ntim@apple.com>

        Make pointer-events checks for SVG take in account inert subtrees
        https://bugs.webkit.org/show_bug.cgi?id=235836

        Reviewed by Antti Koivisto.

        iOS doesn't support test_actions, so it needs different baselines.

        * platform/ios-wk2/imported/w3c/web-platform-tests/html/semantics/interactive-elements/the-dialog-element/inert-svg-hittest-expected.txt: Added.
        * platform/ios-wk2/imported/w3c/web-platform-tests/inert/inert-svg-hittest.tentative-expected.txt: Added.

2022-02-22  Jonathan Bedard  <jbedard@apple.com>

        Unreviewed, reverting r290220.

        Tests still fail with with fuzzy data

        Reverted changeset:

        "Test gardening for [CSS Blending] Non-separable blend modes
        don't work"
        https://bugs.webkit.org/show_bug.cgi?id=131354
        https://commits.webkit.org/r290220

2022-02-22  Asumu Takikawa  <asumu@igalia.com>

        Initial support for Wasm/ESM-integration in the WebCore module loader
        https://bugs.webkit.org/show_bug.cgi?id=236268

        Reviewed by Yusuke Suzuki.

        Add Wasm module MIME type for HTTP tests, and add tests.

        * http/conf/mime.types:
        * http/tests/wasm/resources/empty-module.wasm: Added.
        * http/tests/wasm/wasm-esm-disabled-with-setting-expected.txt: Added.
        * http/tests/wasm/wasm-esm-disabled-with-setting.html: Added.

2022-02-21  Cameron McCormack  <heycam@apple.com>

        Make input element UA shadow tree creation lazy
        https://bugs.webkit.org/show_bug.cgi?id=236747

        Reviewed by Aditya Keerthi.

        * fast/forms/lazy-shadow-tree-creation-expected.html: Added.
        * fast/forms/lazy-shadow-tree-creation.html: Added.
        * fast/forms/lazy-shadow-tree-creation.js: Added.
        (supportsType):
        (makeAndAppendInput):

2022-02-21  Jon Lee  <jonlee@apple.com>

        Unreviewed gardening for the GPU Process bots.
        * css3/color-filters/color-filter-text-decoration-shadow.html:
        * fast/gradients/conic-gradient-alpha-unpremultiplied.html:
        * fast/gradients/conic-gradient-alpha.html:
        * fast/gradients/linear-two-hints-angle.html:
        * fast/scrolling/overflow-inside-foreignobject.html:
        * gpu-process/TestExpectations:
        * imported/blink/svg/custom/crisp-edges-leak.svg:
        * platform/ios/TestExpectations:

2022-02-21  Jon Lee  <jonlee@apple.com>

        Add test name to the image diff template
        https://bugs.webkit.org/show_bug.cgi?id=237003

        Reviewed by Sam Weinig.

        Include the test name in the page. Workflow to update fuzzy match data becomes easier to copy-paste the name there instead of from the location bar.
        * fast/harness/image-diff-template-expected.txt:
        * fast/harness/image-diff-template.html:

== Rolled over to ChangeLog-2022-02-22 ==
